# =============================================================================
# Tmux Configuration - Emacs Style with Homebrew Aesthetic
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------

# Use Emacs-style prefix (C-x instead of C-b)
unbind C-b
set -g prefix C-x
bind C-x send-prefix

# Emacs key bindings in copy mode and command prompt
set -g mode-keys emacs
set -g status-keys emacs

# Enable mouse support
set -g mouse on

# Terminal settings
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Disable automatic-rename (let tmux-window-name plugin handle it)
set -g automatic-rename off
set -g allow-rename off

# Increase scrollback buffer
set -g history-limit 50000

# Faster escape time (for Emacs users)
set -sg escape-time 0

# Focus events for vim/neovim
set -g focus-events on

# Display messages longer
set -g display-time 2000

# Refresh status more often
set -g status-interval 5

# -----------------------------------------------------------------------------
# Emacs-style Key Bindings
# -----------------------------------------------------------------------------

# Window splitting (Emacs style)
# C-x 2 = split below (horizontal line, panes stacked vertically)
# C-x 3 = split right (vertical line, panes side by side)
unbind '"'
unbind %
bind 2 split-window -v -c "#{pane_current_path}"
bind 3 split-window -h -c "#{pane_current_path}"

# Pane management
bind 0 kill-pane                          # C-x 0 = close current pane
bind 1 resize-pane -Z                     # C-x 1 = zoom/maximize pane
bind o display-panes -d 0                 # C-x o = ace-window style pane selection
bind n select-pane -t :.+                 # C-x n = next pane
bind p select-pane -t :.-                 # C-x p = previous pane
bind k kill-pane                          # C-x k = kill pane

# Window management
bind t new-window -c "#{pane_current_path}"  # C-x t = new window (tab)
bind b choose-window                          # C-x b = buffer/window list

# Window navigation
bind N previous-window                        # C-x N = previous window
bind P next-window                            # C-x P = next window

# Go to specific window with C-x w <NUM>
bind w switch-client -T window-table
bind -T window-table 1 select-window -t :1
bind -T window-table 2 select-window -t :2
bind -T window-table 3 select-window -t :3
bind -T window-table 4 select-window -t :4
bind -T window-table 5 select-window -t :5
bind -T window-table 6 select-window -t :6
bind -T window-table 7 select-window -t :7
bind -T window-table 8 select-window -t :8
bind -T window-table 9 select-window -t :9
bind -T window-table 0 select-window -t :10

# Session management
bind s choose-session                     # C-x s = choose session
bind d detach-client                      # C-x d = detach

# Quit tmux (C-x q q)
bind q switch-client -T quit-table
bind -T quit-table q confirm-before -p "Kill tmux server? (y/n)" kill-server

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Help - show all keybindings (Emacs-style C-h for help)
bind C-h list-keys

# Pane navigation with Alt+arrow (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Shift+arrow (no prefix needed)
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 1
bind -n S-Down resize-pane -D 1

# -----------------------------------------------------------------------------
# Homebrew-style Theme (Green on Dark)
# -----------------------------------------------------------------------------

# Colors
BREW_GREEN="#2ecc71"
BREW_DARK_GREEN="#27ae60"
BREW_BG="#1e1e1e"
BREW_FG="#d4d4d4"
BREW_GRAY="#6c6c6c"
BREW_WHITE="#ffffff"

# Status bar
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-style "bg=default,fg=${BREW_FG}"

# Left side: session name
set -g status-left-length 40
set -g status-left "#[fg=${BREW_GREEN},bold][#S] #[default]"

# Right side: empty
set -g status-right-length 0
set -g status-right ""

# Window list
set -g window-status-format "#[fg=${BREW_GRAY}] #I:#W "
set -g window-status-current-format "#[fg=${BREW_GREEN},bold] #I:#W "
set -g window-status-separator ""

# Pane borders - make active pane obvious
# Inactive panes: dim gray border
set -g pane-border-style "fg=#333333"
# Active pane: bright green border
set -g pane-active-border-style "fg=${BREW_GREEN}"

# Show pane border status at top with pane indicator
set -g pane-border-status top
set -g pane-border-format "#{?pane_active,#[fg=${BREW_GREEN}#,bold] #P:#T ,#[fg=#444444] #P }"

# Ensure no background color difference between active/inactive panes
set -g window-style "bg=default"
set -g window-active-style "bg=default"

# Message styling
set -g message-style "bg=default,fg=${BREW_GREEN}"
set -g message-command-style "bg=default,fg=${BREW_GREEN}"

# Mode styling (copy mode, etc.)
set -g mode-style "bg=${BREW_GREEN},fg=${BREW_BG}"

# Clock
set -g clock-mode-colour "${BREW_GREEN}"
set -g clock-mode-style 24

# Display panes (ace-window style) - show until keypress
set -g display-panes-time 2000
set -g display-panes-active-colour "${BREW_GREEN}"
set -g display-panes-colour "${BREW_GRAY}"

# -----------------------------------------------------------------------------
# Plugins (via TPM)
# -----------------------------------------------------------------------------

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# Better clipboard support
set -g @plugin 'tmux-plugins/tmux-yank'

# Smart window naming (must be before tmux-resurrect)
set -g @plugin 'ofirgall/tmux-window-name'

# Save/restore sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Auto-restore last session
set -g @continuum-restore 'on'

# Resurrect options
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
