# ==============================================================================
# Oh My Zsh Configuration
# ==============================================================================

# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Theme (disabled - using Pure theme below)
ZSH_THEME=""

# ZSH AI
export ZSH_AI_PROVIDER="openai-compatible"
export ZSH_AI_OPENAI_MODEL="claude-haiku-4.5"
export ZSH_AI_OPENAI_URL="http://localhost:4141/v1/chat/completions"

# Plugins
plugins=(
    copyfile
    copypath
    direnv
    docker
    fzf
    gcloud
    git
    lol
    pyautoenv
    thefuck
    zsh-autosuggestions
    zsh-syntax-highlighting
    zsh-ai
)

# Load Oh My Zsh
source $ZSH/oh-my-zsh.sh

# Fix comment color for zsh-syntax-highlighting (default is black, invisible on dark backgrounds)
ZSH_HIGHLIGHT_STYLES[comment]=fg=244

# Disable shared history across terminal panes (overrides oh-my-zsh default)
unsetopt share_history

# Pure theme
# NOTE: oh-my-zsh overrides the prompt so Pure must be activated after source $ZSH/oh-my-zsh.sh.
fpath+=($HOME/.zsh/pure)

# Pure also prints newlines between commands. This hack disables the `print`
# command when called from `prompt_pure_precmd`
print() {
  [ 0 -eq $# -a "prompt_pure_precmd" = "${funcstack[-1]}" ] || builtin print "$@";
}

autoload -U promptinit; promptinit
PURE_PROMPT_SYMBOL=Î»

# Change some of the colors
zstyle ':prompt:pure:path' color cyan
zstyle ':prompt:pure:prompt:success' color default

prompt pure

# ==============================================================================
# PATH Configuration
# ==============================================================================

# Go
export GOPATH=$HOME/.go
export PATH="$GOPATH/bin:$PATH"

# Doom Emacs
if [ -d "$HOME/.emacs.d/bin" ]; then
    PATH="$HOME/.emacs.d/bin:$PATH"
fi

# pipx (Created on 2024-07-01)
export PATH="$PATH:$HOME/.local/bin"

# opencode
export PATH="$HOME/.opencode/bin:$PATH"

# ==============================================================================
# Completion System
# ==============================================================================

# uv shell completion
eval "$(uv generate-shell-completion zsh)"

# Angular CLI autocompletion
if [ -x "$(command -v ng)" ]; then
    source <(ng completion script)
fi

# zoxide (must be after compinit)
eval "$(zoxide init zsh)"

# ==============================================================================
# Aliases
# ==============================================================================

# Remove all local branches that have been deleted on the remote
alias git-prune-branches='git fetch -p && git branch -vv | grep ": gone]" | awk "{print \$1}" | xargs git branch -D'

# Tailscale CLI
alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"

# ==============================================================================
# Functions
# ==============================================================================

# Move aerospace workspace to specified monitor
move-workspace() {
    if [[ $# -lt 1 ]]; then
        echo "Usage: move-workspace <workspace_id> [monitor_id]"
        echo "If monitor_id is not provided, it will use 'next'"
        return 1
    fi

    local workspace_id="$1"
    local monitor="${2:-next}"

    aerospace move-workspace-to-monitor --workspace "$workspace_id" "$monitor"
}

# Capture stdout/stderr output to clipboard while displaying it
clip() {
    { echo "\$ $@"; "$@" 2>&1; } | tee /dev/tty | pbcopy
}

# tuitube
export PATH=/Users/damianb/.termcast/compiled/tuitube/bin:$PATH

# bun completions
[ -s "/Users/damianb/.bun/_bun" ] && source "/Users/damianb/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
