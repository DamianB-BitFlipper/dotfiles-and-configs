# ==============================================================================
# Oh My Zsh Configuration
# ==============================================================================

# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Theme (disabled - using Pure theme below)
ZSH_THEME=""

# Smart suggestion config
export SMART_SUGGESTION_PROVIDER_FILE="$HOME/.config/smart-suggestion/config.json"

# Plugins
plugins=(
    direnv
    docker
    fzf
    gcloud
    git
    lol
    pyautoenv
    thefuck
    smart-suggestion
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Load Oh My Zsh
source $ZSH/oh-my-zsh.sh

# Pure theme
# NOTE: oh-my-zsh overrides the prompt so Pure must be activated after source $ZSH/oh-my-zsh.sh.
fpath+=($HOME/.zsh/pure)
autoload -U promptinit; promptinit
PURE_PROMPT_SYMBOL=Î»
prompt pure

# ==============================================================================
# PATH Configuration
# ==============================================================================

# Doom Emacs
if [ -d "$HOME/.emacs.d/bin" ]; then
    PATH="$HOME/.emacs.d/bin:$PATH"
fi

# pipx (Created on 2024-07-01)
export PATH="$PATH:$HOME/.local/bin"

# opencode
export PATH="$HOME/.opencode/bin:$PATH"

# ==============================================================================
# Completion System
# ==============================================================================

# uv shell completion
eval "$(uv generate-shell-completion zsh)"

# Angular CLI autocompletion
if [ -x "$(command -v ng)" ]; then
    source <(ng completion script)
fi

# zoxide (must be after compinit)
eval "$(zoxide init zsh)"

# atuin (shell history)
eval "$(atuin init zsh)"

# ==============================================================================
# Aliases
# ==============================================================================

# Remove all local branches that have been deleted on the remote
alias git-prune-branches='git fetch -p && git branch -vv | grep ": gone]" | awk "{print \$1}" | xargs git branch -D'

# Tailscale CLI
alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"

# ==============================================================================
# Functions
# ==============================================================================

# Move aerospace workspace to specified monitor
move-workspace() {
    if [[ $# -lt 1 ]]; then
        echo "Usage: move-workspace <workspace_id> [monitor_id]"
        echo "If monitor_id is not provided, it will use 'next'"
        return 1
    fi

    local workspace_id="$1"
    local monitor="${2:-next}"

    aerospace move-workspace-to-monitor --workspace "$workspace_id" "$monitor"
}

# Capture stdout/stderr output to clipboard while displaying it
clip() {
    { "$@" 2>&1 | tee /dev/tty | pbcopy; }
}
